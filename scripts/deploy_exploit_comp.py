import os
from dotenv import load_dotenv, find_dotenv
from brownie import *
# VestedAkro, ExploitCompVAkroSwap, accounts, network, web3

from utils.deploy_helpers import deploy_proxy, deploy_admin, get_proxy_admin, upgrade_proxy, deploy_proxy_over_impl


def main():
    # load_dotenv(dotenv_path=Path('..')/".env", override=True)

    # load_dotenv(find_dotenv())

    print(f"You are using the '{network.show_active()}' network")

    akro_token = "0x8ab7404063ec4dbcfd4598215992dc3f8ec853d7"
    vesting_period = 63072000
    vesting_start = 162630720
    vesting_cliff = 0
    minter_akro = "0x5780837C1d9AC3CD9b72203c8A0CFAC73a9FC0b8"
    merkle_roots = \
        [0xf89170b9672ac024fa8135192365ac0dfe38e3c6e93d7a170693d9e784c7e403,
         0x9ce3559fe67390fe81718ba953549f6c8b0de53b78574fef33b7bcbd78ef0ec4,
         0x5a6f89637f81b9ade3ccd7cfc013acd1fbd645110f59e4cff22921d0ba583e1a
        ]

    if (network.show_active() == 'mainnet' or network.show_active() == 'development'):
        if network.show_active() == 'mainnet':
            deployer = accounts.add(os.getenv("DEPLOYER_PRIVATE_KEY"))
            print(f"You are using: 'deployer' [{deployer.address}]")
        elif network.show_active() == "development":
            deployer = accounts[0]
            print(f"You are using: 'deployer' [{deployer.address}]")
        # Deploy vAkro
        vakro = VestedAkro.deploy({"from": deployer})
        print(f"vAkro deployed at {vakro.address}")

        vakro.initialize(akro_token, vesting_period, {"from": deployer})
        print(f"vAkro initialized with akro_token and vesting_period {akro_token, vesting_period}")

        vakro.setVestingStart(vesting_start, {"from": deployer})
        print(f"vAkro vesting start set {vesting_start}")

        vakro.setVestingCliff(vesting_cliff, {"from": deployer})
        print(f"vAkro vesting cliff set {vesting_cliff}")

        vakro.addMinter(minter_akro, {"from": deployer})
        # Deploy Exploit Comp contract
        exploitCompVAkro = ExploitCompVAkroSwap.deploy({"from": deployer})
        print(f"Exploit comp deployed at {exploitCompVAkro.address}")

        exploitCompVAkro.initialize(vakro.address, {"from": deployer})
        print(f"Exploit comp initialised with vakro address {vakro.address}")

        exploitCompVAkro.setMerkleRoots(merkle_roots, {"from": deployer})
        print(f"Exploit comp merkle roots set {merkle_roots}")
        print("====Merkle roots====")
        print(exploitCompVAkro.merkleRoots(0),
              exploitCompVAkro.merkleRoots(1),
              exploitCompVAkro.merkleRoots(2)
             )

        vakro.addMinter(exploitCompVAkro.address, {"from": deployer})
        print(f"Exploit comp minter added {exploitCompVAkro.address}")

        vakro.addSender(exploitCompVAkro.address, {"from": deployer})
        print(f"Exploit comp sender added {exploitCompVAkro.address}")
